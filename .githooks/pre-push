#!/bin/bash
# SinphasÃ© Pre-push Hook - Team Shared Version
# Location: .githooks/pre-push

set -e

PROJECT_ROOT="$(git rev-parse --show-toplevel)"
cd "$PROJECT_ROOT"

echo "ðŸš€ Running SinphasÃ© governance check before push..."

# Run full evaluation
if ! python3 scripts/evaluator/sinphase_cost_evaluator.py --project-root . --report; then
    echo "âŒ SinphasÃ© evaluation failed"
    exit 1
fi

# Check for any violations
if [ -f "SINPHASE_GOVERNANCE_REPORT.md" ]; then
    VIOLATIONS=$(grep -c "GOVERNANCE ZONE" SINPHASE_GOVERNANCE_REPORT.md || echo "0")
    
    if [ "$VIOLATIONS" -gt 0 ]; then
        echo ""
        echo "ðŸš¨ PUSH BLOCKED: SinphasÃ© governance violations detected"
        echo "âŒ $VIOLATIONS components exceed threshold (C > 0.6)"
        echo ""
        echo "This will cause CI/CD pipeline to fail."
        echo "Fix violations before pushing to remote repository."
        exit 1
    fi
fi

echo "âœ… SinphasÃ© governance check passed - safe to push"
